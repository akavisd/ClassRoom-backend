/**
 * New node file
 */

mySQL = {};

function database(dbName, version, comment, dbSize){
	
	var db = require("./mysql-native").createTCPClient(); // localhost:3306 by default
	db.auto_prepare = true;
	db.auth(dbName, "root", "");
	
	var currentRequestsCount = 0;

	var tx = {
		executeSql:function(sql, params, successCallback, errCallback){
			var self = this;
			console.log(sql, params);

			var rows = [];
			
			var exec = db.execute(sql, params);
			exec.addListener('row', function(r) { 
				
					console.log('row', r); 
					rows.push(r);
				
			
			});
			
			exec.addListener('end', function(rs) { 
				console.log('end', rs); 
				successCallback(self, {rows:rows});
			});
			
		},



	}; 

	this.transaction = function(callback){
		callback(tx);
	}

}

 
 mySQL.openDatabase = function(dbName, version, comment, dbSize){
 	console.log(" mySQL.openDatabase");
 	
 	return new database(dbName, version, comment, dbSize);
 }